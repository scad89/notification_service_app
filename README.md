# notification_service_app

Проект сервиса уведомлений

Использовлися седующий стэк

```
- Celery
- Django
- django_celery_beat
- django_phonenumber_field
- Django Rest Framework
- drf-yasg
- psycopg2
- pip-compile-multi
- python-dotenv
- redis
```

## Установка и запуск(локально):

1. Скачать проект https://github.com/scad89/notification_service_app.git
2. Установить зависимости:
   - pip install -r requirements.txt
   - pip-compile -U
3. Сделать миграции:
   - python manage.py makemigrations
   - python manage.py migrate
4. Создать суперпользователя для администраторского Web UI:
   - python manage.py createsuperuser
5. Запустить сервер:
   - python manage.py runserver
6. Запустить Celery в отдельном терминале:
   - celery -A notification_service worker -l info
7. Запустить flower в отдельно терминале:
   - celery -A notification_service flower --port=5555

## Установка и запуск(docker-compose):

    В разработке

## Описание методов и документация:

```
http://127.0.0.1:8000/docs/
```

### Дополнительно реализовано:

- документация(пункт №5)
- администраторский Web UI (http://127.0.0.1:8000/admin/)(пункт №6)
- обработка ошибок удалённого сервера и создание статуса 'Error' сообщения с последующем созданием периодиской задачи(пункт №9)
- реализовано дополнительная возможность отправки уведомлений клиентам в зависимости от часового пояса клиента. Если время не соответствует приемлимому диапазону, задача получает статус 'Wrong Time' и будет повторно запущена через 1 час(пункт №11)

#### В процессе реализации:

- подготовить docker-compose для запуска всех сервисов проекта одной командой(пункт №3)
- организовать тестирование написанного кода(пункт №2)
- обеспечить интеграцию с внешним OAuth2 сервисом авторизации для административного интерфейса. Пример: https://auth0.com (пункт №7)
- реализовать дополнительный сервис, который раз в сутки отправляет статистику по обработанным рассылкам на email(пункт №8)
- реализовать отдачу метрик в формате prometheus и задокументировать эндпоинты и экспортируемые метрики(пункт №10)
- обеспечить подробное логирование на всех этапах обработки запросов, чтобы при эксплуатации была возможность найти в логах всю информацию по(пункт №12):
  - id рассылки - все логи по конкретной рассылке (и запросы на api и внешние запросы на отправку конкретных сообщений)
  - id сообщения - по конкретному сообщению (все запросы и ответы от внешнего сервиса, вся обработка конкретного сообщения)
  - id клиента - любые операции, которые связаны с конкретным клиентом (добавление/редактирование/отправка сообщения/…)
